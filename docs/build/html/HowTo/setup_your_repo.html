

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Set Up your Repository &mdash; fluid-run v0.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Customize Compute Partitions" href="customize_compute_partitions.html" />
    <link rel="prev" title="Ephemeral RCC Tutorial" href="../QuickStart/rcc_ephemeral_tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> fluid-run
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../QuickStart/rcc_ephemeral_tutorial.html">Ephemeral RCC Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Set Up your Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize_compute_partitions.html">Customize Compute Partitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_lustre_file_system.html">Add a Lustre File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize_nfs_file_system.html">Customize NFS File System</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">How To</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Set Up your Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_compute_partitions.html">Customize Compute Partitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_lustre_file_system.html">Add a Lustre File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_nfs_file_system.html">Customize NFS File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_a_datastudio_dashboard.html">Create a Data Studio Dashboard</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Reference/fluid_run_workflow.html">Fluid Run Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/fluid_run_reference.html">The Fluid Run CI File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/dataset_schema.html">Benchmark Dataset Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/environment_variables.html">Environment Variables</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Support/support.html">Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fluid-run</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../QuickStart/rcc_ephemeral_tutorial.html">Ephemeral RCC Tutorial</a> &raquo;</li>
        
      <li>Set Up your Repository</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/HowTo/setup_your_repo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="set-up-your-repository">
<h1>Set Up your Repository<a class="headerlink" href="#set-up-your-repository" title="Permalink to this headline">¶</a></h1>
<p>To use fluid-run, you need to have (at a minimum) a Google Cloud Build configuration file and a fluid-run pipeline file. The simplest location for these files is in the root directory of your repository.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Repository Root
o
<span class="p">|</span>
<span class="p">|</span>
o ./cloudbuild.yaml
<span class="p">|</span>
<span class="p">|</span>
o ./fluid-run.yaml
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">cloudbuild.yaml</span></code> configuration file specifies the steps necessary to build your application and includes a call to fluid-run to test and benchmark your application. Currently, fluid-run is able to test Singularity and Google Compute Engine (GCE) VM Images. If you’re able to create a Docker image for your application, you can easily convert to a Singularity image within your build process before calling fluid-run.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> pipeline file specifies a set of commands or scripts to execute, where to direct output, and the compute partitions to run on.</p>
<div class="section" id="containerize-your-application-with-singularity">
<h2>Containerize your application with Singularity<a class="headerlink" href="#containerize-your-application-with-singularity" title="Permalink to this headline">¶</a></h2>
<p>Containers are a lightweight virtual environment where you install your application and all of it’s depedencies. They are ideal for improving portability of your application and can help developers reproduce issues reported by their end users. Singularity is a container format made specifically for high performance computing and research computing environments, where users often share common compute resources. Singularity has some advantages over other container options, such as Docker, including built in support for exposing AMD and Nvidia GPUs and running on multi-VM / cluster environments.</p>
<p>A Singularity image can be created by writing a <a class="reference external" href="https://sylabs.io/guides/3.0/user-guide/definition_files.html">Singularity definition file</a>. The definition file is essentially a set of instructions that dictate the container image to start from and the commands to run to install your application. We recommend that you review the Singularity documentation to learn more about writing a Singularity definition file. If you have not containerized your application yet, this is a good place to start.</p>
<p>Some users have already containerized their application with Docker. If you fall into this category, but would still like to use fluid-run to test and benchmark your application, you can easily convert your Docker image to a Singularity image. In your <code class="code docutils literal notranslate"><span class="pre">cloudbuild.yaml</span></code>, you will simply add a step to call <code class="code docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">build</span></code> using the local docker-daemon as a source. The example below shows a two stage process that creates a Docker image and a Singularity image. After the build completes, the Docker image is posted to <a class="reference external" href="https://cloud.google.com/container-registry">Google Container Registry</a> and the Singularity image is posted to <a class="reference external" href="https://cloud.google.com/storage">Google Cloud Storage</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>

<span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Build Docker Image</span>
  <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;gcr.io/cloud-builders/docker&#39;</span>
  <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;build&#39;</span><span class="p p-Indicator">,</span>
         <span class="s">&#39;.&#39;</span><span class="p p-Indicator">,</span>
         <span class="s">&#39;-t&#39;</span><span class="p p-Indicator">,</span>
         <span class="s">&#39;gcr.io/${PROJECT_ID}/cowsay:latest&#39;</span>
  <span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Build Singularity Image</span>
  <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;quay.io/singularity/singularity:v3.7.1&#39;</span>
  <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;build&#39;</span><span class="p p-Indicator">,</span>
         <span class="s">&#39;cowsay.sif&#39;</span><span class="p p-Indicator">,</span>
         <span class="s">&#39;docker-daemon://gcr.io/${PROJECT_ID}/cowsay:latest&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">images</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;gcr.io/${PROJECT_ID}/cowsay:latest&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">artifacts</span><span class="p">:</span>
  <span class="nt">objects</span><span class="p">:</span>
    <span class="nt">location</span><span class="p">:</span> <span class="s">&#39;gs://my-singularity-bucket/latest&#39;</span>
    <span class="nt">paths</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;cowsay.sif&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="define-tests">
<h2>Define Tests<a class="headerlink" href="#define-tests" title="Permalink to this headline">¶</a></h2>
<p>Tests for your application are specified in the <code class="code docutils literal notranslate"><span class="pre">execution_command</span></code> field of the <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> pipeline file. The fluid-run build step is able to determine if the provided execution command is a script or a single command. This allows you to either specify all of your tests in a set of scripts in your repository or set individual commands in the <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> file. Currently, when using the <code class="code docutils literal notranslate"><span class="pre">rcc-ephemeral</span></code> or <code class="code docutils literal notranslate"><span class="pre">rcc-static</span></code> cluster types, you must specify a script to run; when using the <code class="code docutils literal notranslate"><span class="pre">gce</span></code> cluster type, you must specify individual commands.</p>
<p>As an example, the <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> file below runs an inline command on the <code class="code docutils literal notranslate"><span class="pre">c2-standard-8</span></code> partition (a partition provided in the default RCC cluster).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tests</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">command_group</span><span class="p">:</span> <span class="s">&quot;hello&quot;</span>
  <span class="nt">execution_command</span><span class="p">:</span> <span class="s">&quot;singularity</span><span class="nv"> </span><span class="s">exec</span><span class="nv"> </span><span class="s">${SINGULARITY_IMAGE}</span><span class="nv"> </span><span class="s">/usr/games/cowsay</span><span class="nv"> </span><span class="s">\&quot;Hello</span><span class="nv"> </span><span class="s">World\&quot;&quot;</span>
  <span class="nt">output_directory</span><span class="p">:</span> <span class="s">&quot;hello/test&quot;</span>
  <span class="nt">partition</span><span class="p">:</span> <span class="s">&quot;c2-standard-8&quot;</span>
  <span class="nt">batch_options</span><span class="p">:</span> <span class="s">&quot;--ntasks=1</span><span class="nv"> </span><span class="s">--cpus-per-task=1&quot;</span>
</pre></div>
</div>
<p>Alternatively, you could create a script in your repository (e.g. <code class="code docutils literal notranslate"><span class="pre">test/hello_world.sh</span></code>) and reference the path to this script in your <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> file. In this case, the contents of the script would have the command(s) you want to run.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
singularity <span class="nb">exec</span> <span class="si">${</span><span class="nv">SINGULARITY_IMAGE</span><span class="si">}</span> /usr/games/cowsay <span class="s2">&quot;Hello World&quot;</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">fluid-run.yaml</span></code> then references this file in the <code class="code docutils literal notranslate"><span class="pre">execution_command</span></code> field.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tests</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">command_group</span><span class="p">:</span> <span class="s">&quot;hello&quot;</span>
  <span class="nt">execution_command</span><span class="p">:</span> <span class="s">&quot;test/hello_world.sh&quot;</span>
  <span class="nt">output_directory</span><span class="p">:</span> <span class="s">&quot;hello/test&quot;</span>
  <span class="nt">partition</span><span class="p">:</span> <span class="s">&quot;c2-standard-8&quot;</span>
  <span class="nt">batch_options</span><span class="p">:</span> <span class="s">&quot;--ntasks=1</span><span class="nv"> </span><span class="s">--cpus-per-task=1&quot;</span>
</pre></div>
</div>
<p>When writing your tests, keep in mind that you can use <a class="reference internal" href="../Reference/environment_variables.html"><span class="doc">environment variables</span></a> provided by fluid-run. If you are using the <code class="code docutils literal notranslate"><span class="pre">rcc-ephemeral</span></code> or <code class="code docutils literal notranslate"><span class="pre">rcc-static</span></code> clusters, you can also use <a class="reference external" href="https://hpcc.umd.edu/hpcc/help/slurmenv.html">Slurm environment variables</a>.</p>
</div>
<div class="section" id="add-a-cloud-build-configuration-file">
<h2>Add a Cloud Build Configuration file<a class="headerlink" href="#add-a-cloud-build-configuration-file" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="customize_compute_partitions.html" class="btn btn-neutral float-right" title="Customize Compute Partitions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../QuickStart/rcc_ephemeral_tutorial.html" class="btn btn-neutral float-left" title="Ephemeral RCC Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Fluid Numerics LLC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>